<div class="task-list">
  <div class="header">
    <h2>
      Task List
      <span class="live-badge">â— LIVE</span>
    </h2>

    <div class="controls">
      <div class="filter">
        <label for="statusFilter">Filter:</label>
        <select
          id="statusFilter"
          [(ngModel)]="filteredStatus"
          (change)="onStatusFilterChange()">
          <option value="">All</option>
          <option *ngFor="let status of statuses.slice(1)" [value]="status">
            {{ status }}
          </option>
        </select>
      </div>

      <button class="refresh-btn" (click)="onManualRefresh()">
        ğŸ”„ Refresh
      </button>
    </div>
  </div>

  <!-- Use async pipe to subscribe to observables -->
  <div *ngIf="loading$ | async" class="loading">
    <div class="spinner"></div>
    Loading tasks...
  </div>

  <div *ngIf="(loading$ | async) === false && (tasks$ | async)?.length === 0" class="no-tasks">
    ğŸ“­ No tasks found. Create one to see the agent in action!
  </div>

  <!-- Async pipe automatically subscribes and unsubscribes -->
  <table *ngIf="(tasks$ | async) as tasks">
    <thead>
    <tr>
      <th>Title</th>
      <th>Status</th>
      <th>Priority</th>
      <th>Due Date</th>
      <th>Escalations</th>
      <th>Created</th>
      <th>Actions</th>
    </tr>
    </thead>
    <tbody>
    <tr *ngFor="let task of tasks">
      <td>
        <strong>{{ task.title }}</strong>
        <div class="description" *ngIf="task.description">
          {{ task.description }}
        </div>
      </td>
      <td>
          <span [class]="getStatusClass(task.status)" class="badge">
            {{ task.status }}
          </span>
      </td>
      <td>
          <span [class]="getPriorityClass(task.priority)" class="badge">
            {{ task.priority }}
          </span>
      </td>
      <td>
          <span *ngIf="task.dueDate">
            {{ task.dueDate | date:'short' }}
          </span>
        <span *ngIf="!task.dueDate">-</span>
      </td>
      <td>{{ task.escalationCount }}</td>
      <td>{{ task.createdAt | date:'short' }}</td>

      <!-- Action buttons (only for non-terminal tasks) -->
      <td>
        <div class="action-buttons" *ngIf="task.status !== 'Completed' && task.status !== 'Rejected'">
          <button
            class="btn-complete"
            (click)="onCompleteTask(task.id)"
            title="Complete this task">
            âœ“ Complete
          </button>

          <button
            class="btn-snooze"
            (click)="onSnoozeTask(task.id)"
            title="Snooze this task">
            â° Snooze
          </button>

          <button
            class="btn-reject"
            (click)="onRejectTask(task.id)"
            title="Reject this task">
            âœ• Reject
          </button>
        </div>

        <div *ngIf="task.status === 'Completed' || task.status === 'Rejected'">
          <span class="terminal-badge">Terminal</span>
        </div>
      </td>
    </tr>
    </tbody>
  </table>
</div>
